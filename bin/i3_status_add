#!/bin/sh
# shell script to prepend i3status with more stuff

yellow='#FFFF00'
red='#FF0000'
green='#00FF00'
btc_rate=/tmp/btc_rate

i3status | while :
do
  read line

  acpi=$(echo $line | perl -ne 'print "$1" if /BAT (\d+)/')
  acpicolor=$green
	[ $acpi -lt '75' ] && acpicolor=$yellow
	[ $acpi -lt '50' ] && acpicolor=$red

  btc_rate=$(w3m https://bitpay.com/api/rates | jq '.[] | select(.code == "USD").rate')& > $btc_rate

  echo $line |
    sed s/,\"full_text\":\"BAT/,\"color\":\"$acpicolor\",\"full_text\":\"BAT/ |
    sed s/\\[\{/\\[\{\"full_text\":\"BTC:\ $(cat $btc_rate)\ USD\"\},\{/
done
